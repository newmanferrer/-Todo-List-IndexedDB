"use strict";var db,colorSeleccionado,form=document.querySelector("#container-form__form"),divColores=document.querySelector("#div-colores"),containerTareas=document.querySelector("#container-tareas"),containerError=document.querySelector("#container-error"),pError=document.querySelector("#container-error__parrafo"),IDB=window.indexedDB,date=new Date,errores=[],mostrarTasks=function(){var e=db.transaction(["tasks"],"readonly").objectStore("tasks").openCursor(),r=document.createDocumentFragment();e.onsuccess=function(){var t=e.result;if(t)if(t.value.estado){var o=document.createElement("DIV");o.className="container-tareas__item",o.style="background-color: ".concat(t.value.color);var a=document.createElement("DIV");a.className="container-tareas__item__div-span";var n=document.createElement("SPAN");n.className="container-tareas__item__div-span__span",n.setAttribute("id","span"),n.style="text-decoration: line-through",n.textContent="".concat(t.value.name);var i=document.createElement("DIV");i.className="container-tareas__item__div-date";var s=document.createElement("LABEL");s.className="container-tareas__item__div-date__date",s.textContent="".concat(t.value.date);var c=document.createElement("DIV");c.className="container-tareas__item__div-modificar";var l=document.createElement("LABEL");l.className="container-tareas__item__div-modificar__label-modificar",l.textContent="Ѵ";var d=document.createElement("DIV");d.className="container-tareas__item__div-borrar";var m=document.createElement("LABEL");m.className="container-tareas__item__div-borrar__label-borrar",m.textContent="X",a.appendChild(n),o.appendChild(a),i.appendChild(s),o.appendChild(i),c.appendChild(l),o.appendChild(c),d.appendChild(m),o.appendChild(d),r.appendChild(o),t.continue()}else{var _=document.createElement("DIV");_.className="container-tareas__item",_.style="background-color: ".concat(t.value.color);var u=document.createElement("DIV");u.className="container-tareas__item__div-span";var v=document.createElement("SPAN");v.className="container-tareas__item__div-span__span",v.setAttribute("id","span"),v.textContent="".concat(t.value.name);var f=document.createElement("DIV");f.className="container-tareas__item__div-date";var p=document.createElement("LABEL");p.className="container-tareas__item__div-date__date",p.textContent="".concat(t.value.date);var h=document.createElement("DIV");h.className="container-tareas__item__div-modificar";var E=document.createElement("LABEL");E.className="container-tareas__item__div-modificar__label-modificar",E.textContent="Ѵ";var C=document.createElement("DIV");C.className="container-tareas__item__div-borrar";var b=document.createElement("LABEL");b.className="container-tareas__item__div-borrar__label-borrar",b.textContent="X",u.appendChild(v),_.appendChild(u),f.appendChild(p),_.appendChild(f),h.appendChild(E),_.appendChild(h),C.appendChild(b),_.appendChild(C),r.appendChild(_),t.continue()}else containerTareas.innerHTML="",containerTareas.appendChild(r)},e.onerror=function(e){console.log(e)}};divColores.addEventListener("click",(function(e){switch(e.preventDefault(),e.target.classList[1]){case"div1":colorSeleccionado="#008000",divColores.firstElementChild.classList.toggle("container-form__form__div-colores__html-div1--active"),divColores.children[1].classList.remove("container-form__form__div-colores__html-div2--active"),divColores.lastElementChild.classList.remove("container-form__form__div-colores__html-div3--active");break;case"div2":colorSeleccionado="#ff4500",divColores.children[1].classList.toggle("container-form__form__div-colores__html-div2--active"),divColores.firstElementChild.classList.remove("container-form__form__div-colores__html-div1--active"),divColores.lastElementChild.classList.remove("container-form__form__div-colores__html-div3--active");break;case"div3":colorSeleccionado="#ff0000",divColores.lastElementChild.classList.toggle("container-form__form__div-colores__html-div3--active"),divColores.firstElementChild.classList.remove("container-form__form__div-colores__html-div1--active"),divColores.children[1].classList.remove("container-form__form__div-colores__html-div2--active");break;case void 0:errores.push("Color de tarea indefinido");break;case null:errores.push("Color de tarea null");break;default:errores.push("Color de tarea requerido")}}));var compararFechas=function(e){var r=date.getFullYear(),t=(date.getMonth()+1).toString(),o=date.getDate().toString();if(t.length<=1&&(t="0".concat(t)),o.length<=1&&(o="0".concat(o)),e<"".concat(r,"-").concat(t,"-").concat(o))return!0},crearTask=function(e,r,t){var o={name:e,date:r,color:t,estado:!1},a=db.transaction(["tasks"],"readwrite").objectStore("tasks").add(o);a.onsuccess=function(){errores=[],pError.textContent="",colorSeleccionado="",divColores.firstElementChild.classList.remove("container-form__form__div-colores__html-div1--active"),divColores.children[1].classList.remove("container-form__form__div-colores__html-div2--active"),divColores.lastElementChild.classList.remove("container-form__form__div-colores__html-div3--active"),containerError.classList.remove("container-error-visible"),form.reset(),mostrarTasks(),form.input_item.focus()},a.onerror=function(e){0===e.target.error.code&&(errores.push("Error: La tarea ya exite en la BD"),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus())}},deleteTask=function(e){var r=db.transaction(["tasks"],"readwrite").objectStore("tasks").delete(e);r.onsuccess=function(){form.reset(),mostrarTasks(),form.input_item.focus()},r.onerror=function(){errores.push("Error: tarea no eliminada de la BD"),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus()}},completedTask=function(e){var r=db.transaction(["tasks"],"readwrite").objectStore("tasks"),t=r.get(e);t.onsuccess=function(){var e=t.result;!0===e.estado?e.estado=!1:e.estado=!0;var o=r.put(e);o.onsuccess=function(){form.reset(),mostrarTasks(),form.input_item.focus()},o.onerror=function(e){errores.push(e),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus()},form.reset(),mostrarTasks(),form.input_item.focus()},t.onerror=function(e){errores.push(e),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus()}},getTask=function(e){var r=db.transaction(["tasks"],"readonly").objectStore("tasks").get(e);r.onsuccess=function(){var e=r.result;form.input_item.value=e.name,form.input_date.value=e.date,form.button.dataset.action="update",form.button.value="U"},r.onerror=function(e){errores.push(e),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus()}},updateTask=function(e,r,t){var o={name:e,date:r,color:t,estado:!1},a=db.transaction(["tasks"],"readwrite").objectStore("tasks").put(o);a.onsuccess=function(){var e=a.result;form.input_item.value=e.name,form.input_date.value=e.date,form.button.dataset.action="add",form.button.value="+",errores=[],pError.textContent="",colorSeleccionado="",divColores.firstElementChild.classList.remove("container-form__form__div-colores__html-div1--active"),divColores.children[1].classList.remove("container-form__form__div-colores__html-div2--active"),divColores.lastElementChild.classList.remove("container-form__form__div-colores__html-div3--active"),containerError.classList.remove("container-error-visible"),form.reset(),mostrarTasks(),form.input_item.focus()},a.onerror=function(e){errores.push(e),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", "),form.input_date.focus()}};if(IDB){var request=IDB.open("DB_task",1);request.onsuccess=function(){db=request.result,console.log("OPEN",db),mostrarTasks()},request.onupgradeneeded=function(){db=request.result,console.log("CREATE",db);db.createObjectStore("tasks",{keyPath:"name"})},request.onerror=function(e){console.log("Error: ",e)}}else console.log("Este navegador no soporta indexedDB"),alert("indexedDB no es soportado por este navegador");form.input_item.focus(),form.addEventListener("submit",(function(e){if(e.preventDefault(),errores=[],""===form.input_item.value?(errores.push("Tarea descripción requerida"),form.input_item.focus()):form.input_item.value.length>60?(errores.push("De [1-60] caracteres, actuales ".concat(form.input_item.value.length)),form.input_item.focus()):null==colorSeleccionado||""===colorSeleccionado?(errores.push("Tarea color requerido"),divColores.firstElementChild.focus()):""===form.input_date.value?(errores.push("Tarea fecha requerida"),form.input_date.focus()):!0===compararFechas(form.input_date.value)&&(errores.push("Fecha menor a la actual"),form.input_date.focus()),errores.length>0)e.preventDefault(),containerError.classList.add("container-error-visible"),pError.textContent="",pError.innerHTML=errores.join(", ");else{var r=form.input_item.value;form.input_item.value="";var t=form.input_date.value,o=colorSeleccionado;"add"===e.target.button.dataset.action?crearTask(r,t,o):"update"===e.target.button.dataset.action&&updateTask(r,t,o)}})),document.addEventListener("DOMContentLoaded",mostrarTasks),containerTareas.addEventListener("click",(function(e){if(e.preventDefault(),"X"===e.target.innerHTML){var r=e.path[2].childNodes[0].innerText.trim();deleteTask(r)}else if("Ѵ"===e.target.innerHTML){var t=e.path[2].childNodes[0].innerText.trim();completedTask(t)}else if("SPAN"===e.path[0].tagName){var o=e.path[0].innerText.trim();getTask(o)}}));